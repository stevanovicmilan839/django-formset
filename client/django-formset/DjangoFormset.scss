@import "dropbox";
@import "dualselector";
@import "colors";

select::placeholder {
	color: rgb(128, 128, 128);
}
select.ts-hidden-accessible {
	display: none;
}

django-formset {
	$feedback-input-fields: 'input[type=email]:not(.dj-exempt-feedback)', 'input[type=text]:not(.dj-exempt-feedback)',
		'input[type=number]:not(.dj-exempt-feedback)', 'input[type=date]:not(.dj-exempt-feedback)',
		'input[type=url]:not(.dj-exempt-feedback)';
	$feedback-fields: #{$feedback-input-fields}, 'select:not(.dj-exempt-feedback)', 'textarea:not(.dj-exempt-feedback)';

	.dj-errorlist {
		list-style: none;
		margin-top: 0;
		margin-bottom: 0;
		margin-left: 0;
		padding-left: 0;
		color: var(--django-formset-color-invalid);
	}

	&.dj-feedback-errors django-field-group.dj-touched:not(.dj-submitted) {
		#{$feedback-fields} {
			&:invalid:not(:focus) {
				border-color: var(--django-formset-color-invalid);
				background-image: var(--django-formset-icon-invalid);
			}
		}
	}

	&.dj-feedback-warnings {
		django-field-group.dj-dirty:not(.dj-submitted) {
			#{$feedback-fields} {
				&:invalid:focus {
					background-image: var(--django-formset-icon-warning);
				}
			}
		}
		&:not(.dj-feedback-errors) {
			django-field-group.dj-dirty:not(.dj-submitted) {
				#{$feedback-fields} {
					&:invalid {
						background-image: var(--django-formset-icon-warning);
					}
				}
			}
		}
	}

	&.dj-feedback-success django-field-group {
		&.dj-dirty {
			#{$feedback-fields} {
				&:valid:not(:focus) {
					border-color: var(--django-formset-color-valid);
				}
			}
			#{$feedback-input-fields} {
				&:valid {
					background-image: var(--django-formset-icon-valid) !important;
				}
			}
		}
	}

	django-field-group {
		display: block;

		&[hidden] {
			display: none;
		}
		&.dj-required, &.dj-required-any {
			> label {
				font-weight: bolder;
			}
		}

		input {
			background-repeat: no-repeat !important;
			background-position: center right !important;
			background-origin: content-box !important;
		}

		select, textarea {
			background-image: none !important;

			&.dj-concealed {
				// HTML fields replaced by counterpart: 'django-selectize', 'django-dual-selector' or 'django-richtext'
				// and hence marked as concealed.
				// Styling with 'display: none;' or 'visible: hidden;' would lead to console error
				// "An invalid form control with name='â€¦' is not focusable" while processing the 'invalid' event handler.
				display: block !important;
				height: 1px !important;
				min-height: initial !important;
				max-height: initial !important;
				padding: 0 !important;
				margin: -1px 0 0 0 !important;
				border: none !important;
				opacity: 0 !important;
				resize: none;
			}
		}

		&.dj-submitted {
			#{$feedback-fields} {
				&:invalid {
					border-color: var(--django-formset-color-invalid);
					background-image: var(--django-formset-icon-invalid);
					&:focus {
						box-shadow: 0 0 0 0.2rem var(--django-formset-shadow-invalid);
					}
				}
			}
		}

		.dj-help-text {
			font-style: oblique;
		}

		.dj-form-optgroup {
			margin-bottom: 0.5rem;
			> em {
				margin-left: 0.75rem;
			}
		}

		.dj-form-inlined {
			display: inline-block;
		}

		input[type="file"] {
			// `display: none;` causes Chrome to complain on calling `form.reportValidity()`.
			width: 0 !important;
			height: 0 !important;
		}

		&.dj-touched input[type="date"] {
			&::-webkit-calendar-picker-indicator {
				opacity: 0;
			}
		}

		.dj-control-panel {
			display: flex;
			> div {
				height: fit-content;
				margin-left: 0.5rem;
				progress {
					width: 100%;
					margin-top: 0.25rem;
				}
			}
		}
		@include Dropbox;
		@include DualSelector;
	}
}

.dj-button-decorator {
	vertical-align: inherit;
	line-height: initial;

	svg {
		vertical-align: middle;
		width: 1rem;
		height: 1rem;

		.path {
			stroke-dasharray: 1000;
			stroke-dashoffset: 0;
			&.circle {
				-webkit-animation: dash 0.9s ease-in-out;
				animation: dash 0.9s ease-in-out;
			}
			&.line {
				stroke-dashoffset: 1000;
				-webkit-animation: dash 0.9s 0.35s ease-in-out forwards;
				animation: dash 0.9s 0.35s ease-in-out forwards;
			}
			&.check {
				stroke-dashoffset: -100;
				-webkit-animation: dash-check 0.9s 0.35s ease-in-out forwards;
				animation: dash-check 0.9s 0.35s ease-in-out forwards;
			}
		}

		@-webkit-keyframes dash {
			0% {
				stroke-dashoffset: 1000;
			}
			100% {
				stroke-dashoffset: 0;
			}
		}

		@keyframes dash {
			0% {
				stroke-dashoffset: 1000;
			}
			100% {
				stroke-dashoffset: 0;
			}
		}

		@-webkit-keyframes dash-check {
			0% {
				stroke-dashoffset: -100;
			}
			100% {
				stroke-dashoffset: 900;
			}
		}

		@keyframes dash-check {
			0% {
				stroke-dashoffset: -100;
			}
			100% {
				stroke-dashoffset: 900;
			}
		}

	}

	@keyframes rotate {
		from {
			transform: rotate(0deg);
		}
		to {
			transform: rotate(360deg);
		}
	}

	.dj-icon {
		display: inline-block;
		width: 1em;
		height: 1em;
	}

	.dj-spinner {
		animation: rotate 1.5s infinite linear;
	}
}
